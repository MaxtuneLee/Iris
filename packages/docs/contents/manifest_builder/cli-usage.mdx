---
title: Command Line Usage
description: Complete guide to using the Afilmory Builder CLI for photo processing and manifest generation.
createdAt: 2025-07-20T22:35:03+08:00
lastModified: 2025-07-20T22:35:03+08:00
---

import { Callout } from '@/src/components/markdown/Callout';

## Basic Commands

### Build Command

The primary command for processing photos and generating manifests:

```bash
# Basic build - processes new and changed photos
pnpm run cli

# Or using npx
npx @afilmory/builder
```

### Common Options

```bash
# Force rebuild all photos (ignores cache)
pnpm run cli --force

# Force regenerate only thumbnails
pnpm run cli --force-thumbnails

# Dry run - show what would be processed without actually doing it
pnpm run cli --dry-run

# Verbose output for debugging
pnpm run cli --verbose

# Quiet mode - minimal output
pnpm run cli --quiet
```

## Advanced Options

### Processing Control

```bash
# Limit concurrency for resource-constrained environments
pnpm run cli --concurrency 4

# Use cluster mode for better performance
pnpm run cli --cluster

# Specify number of worker processes
pnpm run cli --workers 8

# Set memory limit per worker
pnpm run cli --memory-limit 2048
```

### File Filtering

```bash
# Process only specific directory
pnpm run cli --input-dir photos/2024/

# Exclude specific patterns
pnpm run cli --exclude "*.tmp,*.bak,screenshots/*"

# Include only specific file types
pnpm run cli --include "*.jpg,*.jpeg,*.heic"

# Process files modified after specific date
pnpm run cli --since "2024-01-01"
```

### Output Control

```bash
# Specify custom manifest output path
pnpm run cli --output manifest/photos.json

# Generate pretty-printed JSON
pnpm run cli --pretty

# Include debug information in manifest
pnpm run cli --debug

# Generate backup of previous manifest
pnpm run cli --backup
```

## Specialized Commands

### Validation Commands

```bash
# Validate existing manifest
pnpm run cli validate

# Check for missing thumbnails
pnpm run cli validate --check-thumbnails

# Verify all image files are accessible
pnpm run cli validate --check-images

# Compare manifest with actual files
pnpm run cli validate --check-sync
```

### Maintenance Commands

```bash
# Clean up orphaned thumbnails
pnpm run cli cleanup --thumbnails

# Remove cache files
pnpm run cli cleanup --cache

# Clean up temporary files
pnpm run cli cleanup --temp

# Full cleanup (all of the above)
pnpm run cli cleanup --all
```

### Migration Commands

```bash
# Migrate from older manifest version
pnpm run cli migrate --from v4 --to v5

# Migrate storage provider
pnpm run cli migrate --storage-from s3 --storage-to github

# Export manifest to different format
pnpm run cli export --format csv --output photos.csv
```

## Configuration Options

### Config File Selection

```bash
# Use specific config file
pnpm run cli --config builder.prod.config.ts

# Use environment-specific config
NODE_ENV=production pnpm run cli

# Override config via environment
BUILDER_STORAGE_PROVIDER=github pnpm run cli
```

### Runtime Configuration

```bash
# Override storage settings
pnpm run cli --storage-provider s3 --storage-bucket my-bucket

# Override performance settings
pnpm run cli --use-cluster --workers 12 --concurrency 8

# Override feature flags
pnpm run cli --enable-live-photo --disable-hdr-detection
```

## Monitoring and Logging

### Progress Monitoring

```bash
# Show detailed progress
pnpm run cli --progress

# Show processing statistics
pnpm run cli --stats

# Monitor resource usage
pnpm run cli --monitor

# Generate processing report
pnpm run cli --report processing-report.json
```

### Logging Options

```bash
# Set log level
pnpm run cli --log-level debug

# Log to file
pnpm run cli --log-file builder.log

# Structured JSON logging
pnpm run cli --log-format json

# Include timestamps
pnpm run cli --log-timestamps
```

## Examples

### Development Workflow

```bash
# Initial setup - process all photos
pnpm run cli --verbose --progress

# Daily updates - process only new photos
pnpm run cli

# After bulk photo addition
pnpm run cli --force --progress --stats

# Debug processing issues
pnpm run cli --dry-run --verbose --debug
```

### Production Deployment

```bash
# High-performance production build
pnpm run cli \
  --cluster \
  --workers 16 \
  --concurrency 4 \
  --quiet \
  --log-file /var/log/builder.log \
  --report /var/log/build-report.json

# Scheduled maintenance
pnpm run cli cleanup --all
pnpm run cli validate --check-all
```

### Troubleshooting

```bash
# Diagnose processing issues
pnpm run cli --dry-run --verbose --debug

# Check specific photo
pnpm run cli --include "IMG_1234.jpg" --verbose

# Validate manifest integrity
pnpm run cli validate --verbose

# Force reprocess problematic photos
pnpm run cli --force --include "problematic-photos/*"
```

## Environment Variables

Builder CLI respects these environment variables:

```bash
# Configuration
BUILDER_CONFIG_PATH=./custom-config.ts
NODE_ENV=production

# Storage credentials
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
GITHUB_TOKEN=ghp_token

# Performance
BUILDER_WORKERS=8
BUILDER_CONCURRENCY=4
BUILDER_MEMORY_LIMIT=4096

# Logging
BUILDER_LOG_LEVEL=info
BUILDER_LOG_FILE=./builder.log
```

## Exit Codes

The CLI uses standard exit codes:

- `0`: Success
- `1`: General error
- `2`: Configuration error
- `3`: Storage error
- `4`: Processing error
- `5`: Validation error

## Scripting and Automation

### GitHub Actions Example

```yaml
name: Update Photo Manifest
on:
  push:
    paths:
      - 'photos/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build photo manifest
        run: pnpm run cli --cluster --quiet
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      
      - name: Validate manifest
        run: pnpm run cli validate
```

### Cron Job Example

```bash
#!/bin/bash
# daily-photo-update.sh

# Set working directory
cd /path/to/photo/project

# Update photos
pnpm run cli --quiet --log-file /var/log/photo-builder.log

# Check exit code
if [ $? -eq 0 ]; then
    echo "Photo manifest updated successfully"
else
    echo "Photo manifest update failed" >&2
    exit 1
fi

# Cleanup old logs
find /var/log -name "photo-builder.log.*" -mtime +7 -delete
```

<Callout type="info">
**Performance Tip**: Use `--cluster` mode for better performance when processing large photo collections. The optimal number of workers is typically equal to your CPU core count.
</Callout>

<Callout type="warning">
**Resource Management**: When using cluster mode, monitor memory usage as each worker process consumes memory. Adjust `--memory-limit` if you encounter out-of-memory errors.
</Callout>

## Getting Help

```bash
# Show all available commands
pnpm run cli --help

# Show help for specific command
pnpm run cli validate --help

# Show version information
pnpm run cli --version

# Show configuration schema
pnpm run cli config --schema
```

Next: [Storage Providers](./storage-providers.mdx)
