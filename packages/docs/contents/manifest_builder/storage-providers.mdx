---
title: Storage Providers
description: Comprehensive guide to configuring and using different storage backends with Afilmory Builder.
createdAt: 2025-07-20T22:35:03+08:00
lastModified: 2025-07-20T22:35:03+08:00
---

import { Callout } from '@/src/components/markdown/Callout';

## Provider Overview

| Provider | Use Case | Pros | Cons |
|----------|----------|------|------|
| **Amazon S3** | Production, CDN | High performance, global CDN, scalable | Cost for high traffic |
| **GitHub** | Small projects, version control | Free, version history, simple setup | Limited file size, API rate limits |
| **Local** | Development, testing | Fast access, no external dependencies | No redundancy, not suitable for production |

## Amazon S3 Provider

### Basic Configuration

```typescript
export default {
  storage: {
    provider: 's3',
    bucket: 'my-photo-bucket',
    region: 'us-west-2',
    accessKeyId: process.env.AWS_ACCESS_KEY_ID,
    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY
  }
}
```

### Advanced S3 Configuration

```typescript
export default {
  storage: {
    provider: 's3',
    bucket: 'my-photo-bucket',
    region: 'us-west-2',
    
    // Authentication
    accessKeyId: process.env.AWS_ACCESS_KEY_ID,
    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,
    sessionToken: process.env.AWS_SESSION_TOKEN, // For temporary credentials
    
    // Custom endpoint (for S3-compatible services)
    endpoint: 'https://s3.amazonaws.com',
    pathStyle: false, // Use path-style URLs for compatibility
    
    // CDN and custom domain
    customDomain: 'https://photos.example.com',
    
    // Upload configuration
    uploadOptions: {
      acl: 'public-read',
      cacheControl: 'max-age=31536000, immutable',
      contentType: 'image/jpeg',
      metadata: {
        'x-amz-meta-source': 'afilmory-builder'
      },
      
      // Server-side encryption
      serverSideEncryption: 'AES256',
      
      // Storage class
      storageClass: 'STANDARD', // STANDARD, STANDARD_IA, GLACIER, etc.
      
      // Multipart upload settings
      partSize: 10 * 1024 * 1024, // 10MB parts
      queueSize: 1 // Concurrent uploads
    },
    
    // Path structure
    pathStructure: {
      photos: 'photos/{year}/{month}/',
      thumbnails: 'thumbnails/{year}/{month}/',
      manifest: 'manifest/'
    }
  }
}
```

### S3-Compatible Services

#### DigitalOcean Spaces

```typescript
export default {
  storage: {
    provider: 's3',
    bucket: 'my-space',
    region: 'nyc3',
    endpoint: 'https://nyc3.digitaloceanspaces.com',
    accessKeyId: process.env.DO_SPACES_KEY,
    secretAccessKey: process.env.DO_SPACES_SECRET,
    customDomain: 'https://my-space.nyc3.cdn.digitaloceanspaces.com'
  }
}
```

#### Cloudflare R2

```typescript
export default {
  storage: {
    provider: 's3',
    bucket: 'my-r2-bucket',
    region: 'auto',
    endpoint: 'https://your-account-id.r2.cloudflarestorage.com',
    accessKeyId: process.env.R2_ACCESS_KEY_ID,
    secretAccessKey: process.env.R2_SECRET_ACCESS_KEY,
    pathStyle: true // R2 requires path-style URLs
  }
}
```

#### MinIO (Self-hosted)

```typescript
export default {
  storage: {
    provider: 's3',
    bucket: 'photos',
    region: 'us-east-1',
    endpoint: 'http://localhost:9000',
    accessKeyId: 'minioadmin',
    secretAccessKey: 'minioadmin',
    pathStyle: true,
    uploadOptions: {
      acl: 'public-read'
    }
  }
}
```

### S3 Performance Optimization

```typescript
export default {
  storage: {
    provider: 's3',
    // ...basic config
    
    performance: {
      // Connection pooling
      maxSockets: 100,
      timeout: 300000, // 5 minutes
      
      // Retry configuration
      maxRetries: 3,
      retryDelayOptions: {
        base: 300,
        customBackoff: function(retryCount) {
          return Math.pow(2, retryCount) * 100;
        }
      },
      
      // Multipart upload optimization
      multipartUpload: {
        threshold: 20 * 1024 * 1024, // 20MB threshold
        partSize: 10 * 1024 * 1024,  // 10MB parts
        concurrency: 4               // Concurrent parts
      }
    }
  }
}
```

## GitHub Provider

### Basic Configuration

```typescript
export default {
  storage: {
    provider: 'github',
    owner: 'your-username',
    repo: 'photo-storage',
    token: process.env.GITHUB_TOKEN
  }
}
```

### Advanced GitHub Configuration

```typescript
export default {
  storage: {
    provider: 'github',
    owner: 'your-username',
    repo: 'photo-storage',
    branch: 'main', // Target branch
    token: process.env.GITHUB_TOKEN,
    
    // Base URL for raw file access
    baseUrl: 'https://raw.githubusercontent.com/your-username/photo-storage/main',
    
    // Upload options
    uploadOptions: {
      message: 'Add photos via Afilmory Builder', // Commit message
      committer: {
        name: 'Afilmory Builder',
        email: 'builder@afilmory.com'
      },
      author: {
        name: 'Your Name',
        email: 'your.email@example.com'
      },
      
      // Branch strategy
      createBranch: false, // Create feature branches for uploads
      branchPrefix: 'photos/', // Prefix for feature branches
      
      // File handling
      overwrite: false, // Don't overwrite existing files
      autoMerge: true   // Automatically merge feature branches
    },
    
    // Rate limiting
    rateLimiting: {
      enabled: true,
      requestsPerHour: 4000, // GitHub API limit
      burstLimit: 10         // Burst requests
    },
    
    // Path structure
    pathStructure: {
      photos: 'photos/{year}/{month}/',
      thumbnails: 'thumbnails/',
      manifest: ''
    }
  }
}
```

### GitHub Large File Support

For repositories with large files, consider Git LFS:

```typescript
export default {
  storage: {
    provider: 'github',
    // ...basic config
    
    lfs: {
      enabled: true,
      trackPatterns: ['*.jpg', '*.jpeg', '*.png', '*.heic'],
      maxFileSize: 100 * 1024 * 1024 // 100MB threshold
    }
  }
}
```

<Callout type="warning">
**GitHub Limitations**: GitHub has a 100MB file size limit and 1GB repository size soft limit. For larger photo libraries, consider using Git LFS or alternative storage providers.
</Callout>

## Local Storage Provider

### Basic Configuration

```typescript
export default {
  storage: {
    provider: 'local',
    basePath: '/path/to/photos',
    baseUrl: 'http://localhost:3000/photos'
  }
}
```

### Advanced Local Configuration

```typescript
export default {
  storage: {
    provider: 'local',
    basePath: '/var/www/photos',
    baseUrl: 'https://photos.example.com',
    
    // Upload options
    uploadOptions: {
      createDirectories: true, // Auto-create directory structure
      overwrite: false,        // Don't overwrite existing files
      preserveTimestamps: true, // Preserve original file timestamps
      
      // File permissions
      fileMode: 0o644,    // File permissions
      directoryMode: 0o755, // Directory permissions
      
      // Backup options
      createBackups: true,
      backupSuffix: '.bak',
      maxBackups: 5
    },
    
    // Path structure
    pathStructure: {
      photos: 'originals/{year}/{month}/',
      thumbnails: 'thumbnails/{size}/',
      manifest: 'data/'
    },
    
    // Symlink support
    symlinks: {
      enabled: true,
      target: '/mnt/external/photos', // Target for symlinks
      relative: false // Use absolute paths
    }
  }
}
```

### Local Development Setup

```typescript
// builder.config.dev.ts
export default {
  storage: {
    provider: 'local',
    basePath: './dev-photos',
    baseUrl: 'http://localhost:3000/dev-photos',
    
    uploadOptions: {
      createDirectories: true,
      overwrite: true // Allow overwrites in development
    }
  }
}
```

## Provider-Specific Features

### S3 Features

#### CloudFront Integration

```typescript
export default {
  storage: {
    provider: 's3',
    // ...basic config
    
    cloudfront: {
      distributionId: 'E1234567890ABC',
      invalidationPaths: ['/*'], // Paths to invalidate
      invalidationBatch: true    // Batch invalidations
    }
  }
}
```

#### Lifecycle Management

```typescript
export default {
  storage: {
    provider: 's3',
    // ...basic config
    
    lifecycle: {
      enabled: true,
      rules: [
        {
          id: 'TransitionToIA',
          status: 'Enabled',
          transitions: [
            {
              days: 30,
              storageClass: 'STANDARD_IA'
            },
            {
              days: 90,
              storageClass: 'GLACIER'
            }
          ]
        }
      ]
    }
  }
}
```

### GitHub Features

#### Release Integration

```typescript
export default {
  storage: {
    provider: 'github',
    // ...basic config
    
    releases: {
      enabled: true,
      tagPrefix: 'photos-',
      generateChangelog: true,
      includeAssets: ['manifest.json']
    }
  }
}
```

#### Webhook Support

```typescript
export default {
  storage: {
    provider: 'github',
    // ...basic config
    
    webhooks: {
      enabled: true,
      events: ['push', 'pull_request'],
      url: 'https://your-app.com/webhook'
    }
  }
}
```

## Migration Between Providers

Builder supports migrating between different storage providers:

```bash
# Migrate from S3 to GitHub
pnpm run cli migrate \
  --from-provider s3 \
  --from-bucket old-bucket \
  --to-provider github \
  --to-repo new-repo

# Migrate with filtering
pnpm run cli migrate \
  --from-provider local \
  --from-path ./old-photos \
  --to-provider s3 \
  --to-bucket new-bucket \
  --include "*.jpg,*.jpeg" \
  --dry-run
```

## Performance Comparison

| Operation | S3 | GitHub | Local |
|-----------|----|----|-------|
| **Upload Speed** | Fast | Slow (API limits) | Fastest |
| **Download Speed** | Fast (CDN) | Medium | Fastest |
| **Scalability** | Excellent | Limited | Poor |
| **Cost** | Variable | Free (limits) | Hardware only |
| **Reliability** | Excellent | Good | Depends on setup |

## Best Practices

### S3 Best Practices

1. **Use CloudFront**: Configure CDN for better global performance
2. **Optimize costs**: Use lifecycle policies for infrequent access
3. **Security**: Use IAM roles instead of hardcoded credentials
4. **Monitoring**: Enable CloudWatch metrics and logging

### GitHub Best Practices

1. **Repository limits**: Keep repositories under 1GB when possible
2. **API limits**: Respect rate limits and use efficient batching
3. **Branch strategy**: Use feature branches for large uploads
4. **LFS for large files**: Enable Git LFS for files over 50MB

### Local Best Practices

1. **Backup strategy**: Implement regular backups
2. **Permissions**: Set appropriate file and directory permissions
3. **Monitoring**: Monitor disk space and performance
4. **Network access**: Ensure proper network configuration for serving files

<Callout type="info">
**Provider Selection**: Choose S3 for production applications with high traffic, GitHub for small projects with version control needs, and Local for development or self-hosted solutions.
</Callout>

Next: [API Reference](./api-reference.mdx)
